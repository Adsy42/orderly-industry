# Data Model: Natural Language to IQL Translation

**Feature**: 006-nl-iql-translation  
**Date**: 2025-01-27

## Overview

This feature is **stateless** and does not require persistent data storage. All translation operations are performed on-demand via API calls. No database schema changes are required.

## Entities

### Translation Request (Transient)

Represents a natural language query submitted for translation.

**Fields**:
- `query` (string): Natural language description of clause search
- `timestamp` (datetime): Request timestamp (implicit, not stored)

**Lifecycle**: Created on API request → Processed → Response returned → Discarded

### Translation Response (Transient)

Represents the result of a translation operation.

**Fields**:
- `iql` (string): Translated IQL query syntax
- `explanation` (string, optional): Human-readable explanation
- `templates_used` (string[], optional): List of IQL template names used
- `confidence` (number, optional): Confidence score (0-1)

**Lifecycle**: Generated by translation service → Returned to client → Discarded

### Query Mode State (Client-Side Only)

Represents the current input mode in the UI component.

**Fields**:
- `mode` (enum: "natural-language" | "iql"): Current input mode
- `inputText` (string): Current input field text

**Storage**: React component state (in-memory only, no persistence)

**Lifecycle**: Set by user toggle → Maintained during session → Lost on page refresh

---

## Data Flow

```
User Input (Natural Language)
    ↓
Translation API Request
    ↓
Translation Service (LLM)
    ↓
Translation Response (IQL Query)
    ↓
IQL Validation
    ↓
IQL Execution API
    ↓
Results Display
```

**No persistent storage required** - all operations are stateless API calls.

---

## Validation Rules

### Natural Language Query

- **Required**: Query must be non-empty string
- **Length**: No explicit limit (handled by translation service)
- **Format**: Plain text, may contain legal terminology

### Translated IQL Query

- **Format**: Must conform to IQL specification syntax
- **Validation**: Uses existing `validateIQLQuery` from `iql-validation.ts`
- **Templates**: Must reference valid templates from `iql-templates.ts`
- **Operators**: Must follow IQL operator precedence rules

---

## State Management

### Client-Side State (React Component)

**Component**: `IQLQueryBuilder`

**State Variables**:
- `mode`: `"natural-language" | "iql"` (default: `"natural-language"`)
- `query`: `string` (current input text)
- `translatedIQL`: `string | null` (translated query, if available)
- `isTranslating`: `boolean` (loading state)

**State Transitions**:
- User toggles mode → `mode` updates, `query` preserved
- User enters text → `query` updates
- Translation succeeds → `translatedIQL` set, `isTranslating` = false
- Translation fails → `translatedIQL` = null, error state set

---

## Notes

- No database tables needed for this feature
- No migration files required
- Translation history not persisted (stateless service)
- Mode preference not persisted (users can choose mode each session)
- Existing saved queries functionality (`saved_iql_queries` table) unaffected



